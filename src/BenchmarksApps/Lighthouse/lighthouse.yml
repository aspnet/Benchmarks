imports:
  - https://github.com/aspnet/Benchmarks/blob/main/scenarios/aspnet.profiles.standard.yml?raw=true

variables:
  serverPort: 5000
  serverScheme: http

jobs:
  runTemplate:
    source:
      repository: https://github.com/aspnet/benchmarks.git
      branchOrCommit: mbuck/lighthouse-metrics
      project: src/BenchmarksApps/RunTemplate/RunTemplate.csproj
    arguments: --urls {{serverScheme}}://{{serverAddress}}:{{serverPort}} {{runTemplateArgs}}
    readyStateText: Template is running

  lighthouse:
    source:
      repository: https://github.com/aspnet/benchmarks.git
      branchOrCommit: mbuck/lighthouse-metrics
      # dockerImageName: lighthouse
      dockerContextDirectory: src/BenchmarksApps/Lighthouse/
      dockerFile: src/BenchmarksApps/Lighthouse/Dockerfile
    environmentVariables:
      SERVER_SCHEME: '{{serverScheme}}'
      SERVER_ADDRESS: '{{serverAddress}}'
      SERVER_PORT: '{{serverPort}}'
    arguments: "--clean"
    # buildArguments:
    #   - ARG_SERVER_SCHEME='{{serverScheme}}'
    #   - ARG_SERVER_ADDRESS='{{serverAddress}}'
    #   - ARG_SERVER_PORT='{{serverPort}}'

scenarios:
  test:
    application:
      job: runTemplate
      variables:
        runTemplateArgs: blazor -int Server
    load:
      job: lighthouse
