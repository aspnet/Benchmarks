parameters:
- name: server
  type: string
  default: ''
- name: client
  type: string
  default: ''
- name: cpuCount
  type: number
  default: 32

# Scenarios
- name: scenarios 
  type: object
  default: 
  - displayName: "Plaintext"
    arguments: "-n Plaintext $(plaintextJobs)"
  - displayName: "Plaintext non pipelined"
    arguments: "-n PlaintextNonPipelined $(plaintextJobs)"
  - displayName: "Plaintext Mvc"
    arguments: "-n MvcPlaintext $(plaintextJobs)"
  
  
variables:
  defaultArgs: --server $(server) --client $(client) --runtimeversion 5.0.* --self-contained --warmup 5 --duration 5 --collect-counters --description Trend/Latest
  sqlArgs: --table \"BENCHMARKS_CONNECTION_STRING\"

  plaintextJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/Benchmarks/benchmarks.plaintext.json"
  htmlJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/Benchmarks/benchmarks.html.json"
  jsonJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/Benchmarks/benchmarks.json.json"
  multiQueryJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/Benchmarks/benchmarks.multiquery.json"
  httpClientJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/BenchmarksApps/HttpClient/Proxy/benchmarks.json"
  plaintextPlatformJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/BenchmarksApps/Kestrel/PlatformBenchmarks/benchmarks.plaintext.json --sdk 5.0.100-preview.4.20202.8"
  jsonPlatformJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/BenchmarksApps/Kestrel/PlatformBenchmarks/benchmarks.json.json --sdk 5.0.100-preview.4.20202.8"
  routingJobs: -j https://raw.githubusercontent.com/aspnet/AspNetCore/master/src/Routing/benchmarkapps/Benchmarks/benchmarks.json"
  basicApiJobs: --database MySql --jobs https://raw.githubusercontent.com/aspnet/AspNetCore/master/src/Mvc/benchmarkapps/BasicApi/benchmarks.json --duration 60"
  basicViewsJobs: --database MySql --jobs https://raw.githubusercontent.com/aspnet/AspNetCore/master/src/Mvc/benchmarkapps/BasicViews/benchmarks.json --duration 60"
  http2Jobs: --clientName H2Load -p Streams=70 --headers None " # --connections ${{ cpuCount }} --clientThreads ${{ cpuCount }}
  blazorJobs: -j https://raw.githubusercontent.com/aspnet/Benchmarks/master/src/Benchmarks/benchmarks.blazor.json"

# Agent-less jobs need this pool
pool: server

jobs:
- job: Trend
  steps:
  - ${{ each s in parameters.scenarios }}:
    - template: trend-citrine-template.yml # todo: make it a parameter to target a different template for cloud
      parameters:
        displayName: ${{ s.displayName }}
        arguments: "${{ s.arguments }} $(defaultArgs) $(sqlArgs)"
