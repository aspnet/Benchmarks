# Do not change this file, it is generated using these steps:
# - The file benchmarks*.json defines how each pipeline set of jobs is run in parallel
# - Update the associated benchmarks*.json file with machine and scenario updates
# - Install python and install the requirements for the crank-scheduler in benchmarks/scripts/crank-scheduler/requirements.txt
# - Run the scheduler specifying the desired benchmarks*.json file, this template, and benchmarks/output to automatically overwrite the current pipeline.
# - Ex. python ./scripts/crank-scheduler/main.py --config ./build/benchmarks_ci.json --template ./build/benchmarks.template.liquid --yaml-output ./build

trigger: none
pr: none

schedules:
- cron: "0 9/12 * * *"
  always: true # always run the pipeline even if there have not been source code changes since the last successful scheduled run.
  branches:
    include:
    - main

variables:
  - template: job-variables.yml
  - name: session
    value: $(Build.BuildNumber)
  - name: buildId
    value: $(Build.BuildId)
  - name: buildNumber
    value: $(Build.BuildNumber)
  - name: am
    value: $[lt(format('{0:HH}', pipeline.startTime), 12)]
  - name: pm
    value: $[ge(format('{0:HH}', pipeline.startTime), 12)]

jobs:

# GROUP 1

- job: Containers_Azure_Server_Arm64
  displayName: 1- Containers Azure Server Arm64
  pool: server
  timeoutInMinutes: 120
  dependsOn: []
  condition: succeededOrFailed()
  steps:
  - template: containers-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azure
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure-server-arm64-app --profile azure-client-load --profile azure-db-db "
      
- job: Containers_Azure2_Server_Amd64
  displayName: 1- Containers Azure2 Server Amd64
  pool: server
  timeoutInMinutes: 120
  dependsOn: []
  condition: succeededOrFailed()
  steps:
  - template: containers-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azurearm64
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure2-server-amd64-app --profile azure2-client-load --profile azure2-db-db "
      
# GROUP 2

- job: Baselines_Database_Azure_Server_Arm64
  displayName: 2- Baselines Database Azure Server Arm64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Containers_Azure_Server_Arm64, Containers_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: baselines-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azure
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure-server-arm64-app --profile azure-client-load --profile azure-db-db "
      
- job: Baselines_Database_Azure2_Server_Amd64
  displayName: 2- Baselines Database Azure2 Server Amd64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Containers_Azure_Server_Arm64, Containers_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: baselines-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azurearm64
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure2-server-amd64-app --profile azure2-client-load --profile azure2-db-db "
      
# GROUP 3

- job: Baselines_Azure_Server_Arm64
  displayName: 3- Baselines Azure Server Arm64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Database_Azure_Server_Arm64, Baselines_Database_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: baselines-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azure
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure-server-arm64-app --profile azure-client-load "
      
- job: Baselines_Azure2_Server_Amd64
  displayName: 3- Baselines Azure2 Server Amd64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Database_Azure_Server_Arm64, Baselines_Database_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: baselines-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azurearm64
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure2-server-amd64-app --profile azure2-client-load "
      
# GROUP 4

- job: Trends_Azure_Server_Arm64
  displayName: 4- Trends Azure Server Arm64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Azure_Server_Arm64, Baselines_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azure
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure-server-arm64-app --profile azure-client-load "
      
- job: Trends_Azure2_Server_Amd64
  displayName: 4- Trends Azure2 Server Amd64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Baselines_Azure_Server_Arm64, Baselines_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azurearm64
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure2-server-amd64-app --profile azure2-client-load "
      
# GROUP 5

- job: Trends_Idna_Amd_Lin
  displayName: 5- Trends Idna Amd Lin
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Azure_Server_Arm64, Trends_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azure
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile idna-amd-lin-app --profile idna-intel-lin-load "
      
- job: Trends_Idna_Amd_Win
  displayName: 5- Trends Idna Amd Win
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Azure_Server_Arm64, Trends_Azure2_Server_Amd64]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azurearm64
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile idna-amd-win-app --profile idna-intel-win-load "
      
# GROUP 6

- job: Trends_Idna_Intel_Lin
  displayName: 6- Trends Idna Intel Lin
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Idna_Amd_Lin, Trends_Idna_Amd_Win]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azure
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile idna-intel-lin-app --profile idna-amd-lin-load "
      
- job: Trends_Idna_Intel_Win
  displayName: 6- Trends Idna Intel Win
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Idna_Amd_Lin, Trends_Idna_Amd_Win]
  condition: succeededOrFailed()
  steps:
  - template: trend-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azurearm64
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile idna-intel-win-app --profile idna-amd-win-load "
      
# GROUP 7

- job: Trends_Database_Azure_Server_Arm64
  displayName: 7- Trends Database Azure Server Arm64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Idna_Intel_Lin, Trends_Idna_Intel_Win]
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azure
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure-server-arm64-app --profile azure-client-load --profile azure-db-db "
      
- job: Trends_Database_Azure2_Server_Amd64
  displayName: 7- Trends Database Azure2 Server Amd64
  pool: server
  timeoutInMinutes: 120
  dependsOn: [Trends_Idna_Intel_Lin, Trends_Idna_Intel_Win]
  condition: succeededOrFailed()
  steps:
  - template: trend-database-scenarios.yml
    parameters:
      connection: ASPNET Benchmarks Service Bus
      serviceBusQueueName: azurearm64
      serviceBusNamespace: aspnetbenchmarks
      arguments: "$(ciProfile) --profile azure2-server-amd64-app --profile azure2-client-load --profile azure2-db-db "
      
