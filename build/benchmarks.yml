# Orchestrates all benchmarks

variables:
  - template: job-variables.yml
  - name: session
    value: "$[format('{0:yyyyMMddHHmm}', pipeline.startTime)]"

jobs:
- job: SignalR
  pool: server
  timeoutInMinutes: 120
  dependsOn: gRPCv2
  condition: succeededOrFailed()
  strategy:
    maxParallel: 1
    matrix: 
      Intel_Linux:
        server: http://asp-citrine-lin:5001
      Intel_Windows:
        server: http://asp-citrine-win:5001
  steps:
  - template: signalr-scenarios.yml
    parameters:
      server: $(server)
      client: http://asp-citrine-load:5002
      warmup: 15
      duration: 15
      connection: 'ASP.NET Benchmarks Queue'
      
# CLOUD SCENARIOS

- job: TrendsAzure
  displayName: Trends Azure
  pool: server
  timeoutInMinutes: 180
  steps: 
  - template: trend-scenarios.yml
    parameters:
      warmup: 15
      duration: 15
      server: http://10.0.0.9:5001
      client: http://10.0.0.10:5002
      connection: 'ASP.NET Benchmarks Azure Queue'

- job: SignalRAzure
  displayName: SignalR Azure
  pool: server
  timeoutInMinutes: 180
  dependsOn: TrendsAzure
  condition: succeededOrFailed()
  steps:
  - template: signalr-scenarios.yml
    parameters:
      server: http://10.0.0.9:5001
      client: http://10.0.0.10:5002
      warmup: 15
      duration: 15
      connection: 'ASP.NET Benchmarks Azure Queue'
